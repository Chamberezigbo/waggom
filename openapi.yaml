openapi: 3.1.0
info:
  title: Church Project API
  version: 1.0.0
  description: Minimal admin auth API (single admin).

servers:
  - url: http://localhost:3000/api
    description: Local development server

paths:
  /admin/login:
    post:
      summary: Admin login
      description: Authenticate the single admin and return an access token.
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminLoginRequest"
            examples:
              example:
                value:
                  email: waggom@admin.com
                  password: ChangeMe123!
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminLoginResponse"
              examples:
                example:
                  value:
                    accessToken: "eyJhbGciOi..."
                    tokenType: "Bearer"
                    expiresIn: 3600
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                example:
                  value:
                    error: "invalid_credentials"
                    message: "Email or password is incorrect."

  /admin/news:
    post:
      summary: Create news (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewsCreate'
      responses:
        '201':
          description: News created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsResponse'
    get:
      summary: List news (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: News list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/NewsResponse'

  /admin/news/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    get:
      summary: Get news by id (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: News
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsResponse'
    put:
      summary: Update news (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewsUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsResponse'
    delete:
      summary: Delete news (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

  /admin/events:
    post:
      summary: Create event (admin)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventCreate'
      responses:
        '201':
          description: Event created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventResponse'
    get:
      summary: List events (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Event list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/EventResponse'

  /admin/events/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    get:
      summary: Get event by id (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Event
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventResponse'
    put:
      summary: Update event (admin)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventResponse'
    delete:
      summary: Delete event (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

  /testimonies:
    post:
      summary: Submit a testimony (public)
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/TestimonyCreate'
      responses:
        '201':
          description: Testimony submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestimonyResponse'

  /admin/testimonies:
    get:
      summary: List testimonies (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, approved, rejected]
          description: Filter by status
      responses:
        '200':
          description: Testimony list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestimonyResponse'

  /admin/testimonies/{id}:
    get:
      summary: Get testimony by id (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Testimony
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestimonyResponse'
    delete:
      summary: Delete testimony (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }

  /admin/testimonies/{id}/approve:
    post:
      summary: Approve testimony (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestimonyResponse'

  /admissions:
    post:
      summary: Apply for admission (public)
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/AdmissionCreate'
      responses:
        '201':
          description: Admission submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdmissionResponse'

  /admin/admissions:
    get:
      summary: List admissions (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, approved, rejected]
          description: Filter by status
      responses:
        '200':
          description: Admission list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AdmissionResponse'

  /admin/admissions/{id}:
    get:
      summary: Get admission by id (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Admission
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdmissionResponse'
    delete:
      summary: Delete admission (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }

  /admin/admissions/{id}/approve:
    post:
      summary: Approve admission (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdmissionResponse'

  /admin/admissions/{id}/reject:
    post:
      summary: Reject admission (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Rejected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdmissionResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    AdminLoginRequest:
      type: object
      required: [email, password]
      additionalProperties: false
      properties:
        email:
          type: string
          format: email
          description: Admin email (single admin account).
          examples: ["admin@church.local"]
        password:
          type: string
          format: password
          minLength: 8
          description: Admin password.
    AdminLoginResponse:
      type: object
      required: [accessToken, tokenType, expiresIn]
      additionalProperties: false
      properties:
        accessToken:
          type: string
          description: JWT or opaque token.
        tokenType:
          type: string
          enum: [Bearer]
        expiresIn:
          type: integer
          description: Token lifetime in seconds.
          minimum: 1
    ErrorResponse:
      type: object
      required: [error, message]
      additionalProperties: false
      properties:
        error:
          type: string
        message:
          type: string
    NewsCreate:
      type: object
      required: [title, body]
      properties:
        title:
          type: string
        summary:
          type: string
        category:
          type: string
        body:
          type: string
    NewsUpdate:
      type: object
      properties:
        title:
          type: string
        summary:
          type: string
        category:
          type: string
        body:
          type: string
    NewsResponse:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        summary:
          type: string
        category:
          type: string
        body:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    EventCreate:
      type: object
      required: [title, date, location, description]
      properties:
        title: { type: string }
        date: { type: string, format: date-time }
        location: { type: string }
        description: { type: string }
    EventUpdate:
      type: object
      properties:
        title: { type: string }
        date: { type: string, format: date-time }
        location: { type: string }
        description: { type: string }
    EventResponse:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        date: { type: string, format: date-time }
        location: { type: string }
        description: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    TestimonyResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
        message:
          type: string
        photoUrl:
          type: string
        status:
          type: string
          enum: [pending, approved, rejected]
        createdAt:
          type: string
          format: date-time
    TestimonyCreate:
      type: object
      required: [name, email, message]
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        message:
          type: string
        photo:
          type: string
          format: binary
    AdmissionCreate:
      type: object
      required:
        - programmeLevel
        - programmeChoice
        - surname
        - firstname
        - dateOfBirth
        - placeOfBirth
        - gender
        - presentAddress
        - email
        - phone
        - permanentAddress
        - postalAddress
        - nationality
        - nativeLanguage
        - placeDiffNationality
        - maritalStatus
        - religion
        - denomination
        - parentGuardian
        - emergencyContact
        - emergencyPhone
        - nextOfKin
        - nextOfKinPhone
        - financeInfo
        - healthInfo
        - academicReferee
        - academicProfession
        - academicInstitution
        - academicAddress
        - academicPhone
        - academicEmail
        - clergyReferee
        - clergyPosition
        - clergyChurch
        - clergyAddress
        - clergyPhone
        - clergyEmail
        - applicantSignature
        - applicantDate
        - education
      properties:
        programmeLevel: { type: string }
        programmeChoice: { type: string }
        passportPhotos:
          type: array
          items: { type: string, format: binary }
        surname: { type: string }
        firstname: { type: string }
        title: { type: string }
        otherNames: { type: string }
        dateOfBirth: { type: string, format: date }
        placeOfBirth: { type: string }
        gender: { type: string }
        presentAddress: { type: string }
        email: { type: string, format: email }
        phone: { type: string }
        permanentAddress: { type: string }
        postalAddress: { type: string }
        nationality: { type: string }
        nativeLanguage: { type: string }
        placeDiffNationality: { type: boolean }
        maritalStatus: { type: string }
        religion: { type: string }
        denomination: { type: string }
        parentGuardian: { type: string }
        emergencyContact: { type: string }
        emergencyPhone: { type: string }
        nextOfKin: { type: string }
        nextOfKinPhone: { type: string }
        financeInfo: { type: string }
        healthInfo: { type: string }
        description: { type: string }
        academicReferee: { type: string }
        academicProfession: { type: string }
        academicInstitution: { type: string }
        academicAddress: { type: string }
        academicPhone: { type: string }
        academicEmail: { type: string }
        clergyReferee: { type: string }
        clergyPosition: { type: string }
        clergyChurch: { type: string }
        clergyAddress: { type: string }
        clergyPhone: { type: string }
        clergyEmail: { type: string }
        applicantSignature: { type: string }
        applicantDate: { type: string, format: date }
        education:
          type: array
          items:
            type: object
            properties:
              institution: { type: string }
              from: { type: string, format: date }
              to: { type: string, format: date }
              qualification: { type: string }
        certificates:
          type: array
          items: { type: string, format: binary }
    AdmissionResponse:
      type: object
      properties:
        id: { type: string }
        status: { type: string }
        createdAt: { type: string, format: date-time }